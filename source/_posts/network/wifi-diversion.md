---
title: WIFI分流
date: 2024-02-19 17:16:53
categories:
- Network
tags:
- 组网
---

> 不是所有设备，所以系统都可以装vpn，可以指定协议代理，但是几乎所有设备都可以连接wifi，而所有设备都可以修改网络的网关和dns服务器，就着这个思路，旁路由实现透明代理，主路由正常线路。不同wifi指定不同网关跟路由器可以实现wifi分流
> 

<!-- more -->

## 拓扑图

{% image fancybox left clear group:IT wifi.png %}

1. 光猫桥接
2. 主路由对公网地址的第一层NAT，lan地址192.168.0.1
    1. DHCP设置网关跟DNS指向自己
    {% image fancybox left clear group:IT wifi0.png %}
              
3. 旁路由桥接主路由，lan地址192.168.0.50
    1. 旁路由需要关闭dhcp
    2. 旁路由网关跟DNS均为主路由lan地址192.168.0.1
4. 无线AP，lan地址192.168.0.100，连接该网络的设备不走代理，网关跟DNS均指向192.168.0.1
5. 无线路由，第二层NAT，wan地址为192.168.0.170，lan地址为192.168.2.1
    1. DHCP设置网关跟DNS服务器指向旁路由地址192.168.0.50
    {% image fancybox left clear group:IT wifi1.png %}
    
6. 由于5中设置了网关为旁路由，所以连接该无线路由的设备流量都会途径旁路由进行流量代理后再发往公网，虚线表示非物理连接（物理路径是设备→主路由→旁路由→主路由→公网
7. 设备连接wifi
8. 设备连接wifi
9. 设备连接wifi

## 补充

1. 默认情况下，192.168.0.0/24 网段无法访问192.168.2.0/24，需要往主路由的路由表添加路径规则，只需要对192.168.2.0/24 指定无线路由192.168.0.170的网关就行
    {% image fancybox left clear group:IT wifi2.png %}
    
    
2. 设置完路由规则后，仍然无法跨网段访问
    
    这种情况一般是路由器的防火墙问题，比如我的无线路由使用的是电信赠送的路由器，不只需要关闭防火墙，还需要开放192.168.0.0/24地址池的访问权限
    
    {% image fancybox left clear group:IT wifi3.png %}
